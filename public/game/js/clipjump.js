(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};!function(){var F2,F3,G2,G3,Grad,fade,grad3,gradP,lerp,module,p,perm;Grad=function(x,y,z){this.x=x,this.y=y,this.z=z},fade=function(t){return t*t*t*(t*(6*t-15)+10)},lerp=function(a,b,t){return(1-t)*a+t*b},module=window.Noise=function(num_iterations,persistence,freq,low,high,seed){this.num_iterations=num_iterations,this.persistence=persistence,this.freq=freq,this.low=low,this.high=high,this.seed=seed},module.prototype.get=function(x,y){var amp,freq,i,maxAmp,noise;for(maxAmp=0,amp=1,noise=0,freq=this.freq,Noise.seed(this.seed),i=0;i<this.num_iterations;)noise+=Noise.simplex2(x*freq,y*freq)*amp,maxAmp+=amp,amp*=this.persistence,freq*=2,++i;return noise/=maxAmp,noise=noise*(this.high-this.low)/2+(this.high+this.low)/2},Grad.prototype.dot2=function(x,y){return this.x*x+this.y*y},Grad.prototype.dot3=function(x,y,z){return this.x*x+this.y*y+this.z*z},grad3=[new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)],p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],perm=new Array(512),gradP=new Array(512),module.seed=function(seed){var i,v;for(seed>0&&1>seed&&(seed*=65536),seed=Math.floor(seed),256>seed&&(seed|=seed<<8),i=0;256>i;)v=void 0,v=1&i?p[i]^255&seed:p[i]^seed>>8&255,perm[i]=perm[i+256]=v,gradP[i]=gradP[i+256]=grad3[v%12],i++},module.seed(0),F2=.5*(Math.sqrt(3)-1),G2=(3-Math.sqrt(3))/6,F3=1/3,G3=1/6,module.simplex2=function(xin,yin){var gi0,gi1,gi2,i,i1,j,j1,n0,n1,n2,s,t,t0,t1,t2,x0,x1,x2,y0,y1,y2;return n0=void 0,n1=void 0,n2=void 0,s=(xin+yin)*F2,i=Math.floor(xin+s),j=Math.floor(yin+s),t=(i+j)*G2,x0=xin-i+t,y0=yin-j+t,i1=void 0,j1=void 0,x0>y0?(i1=1,j1=0):(i1=0,j1=1),x1=x0-i1+G2,y1=y0-j1+G2,x2=x0-1+2*G2,y2=y0-1+2*G2,i&=255,j&=255,gi0=gradP[i+perm[j]],gi1=gradP[i+i1+perm[j+j1]],gi2=gradP[i+1+perm[j+1]],t0=.5-x0*x0-y0*y0,0>t0?n0=0:(t0*=t0,n0=t0*t0*gi0.dot2(x0,y0)),t1=.5-x1*x1-y1*y1,0>t1?n1=0:(t1*=t1,n1=t1*t1*gi1.dot2(x1,y1)),t2=.5-x2*x2-y2*y2,0>t2?n2=0:(t2*=t2,n2=t2*t2*gi2.dot2(x2,y2)),70*(n0+n1+n2)},module.simplex3=function(xin,yin,zin){var gi0,gi1,gi2,gi3,i,i1,i2,j,j1,j2,k,k1,k2,n0,n1,n2,n3,s,t,t0,t1,t2,t3,x0,x1,x2,x3,y0,y1,y2,y3,z0,z1,z2,z3;return n0=void 0,n1=void 0,n2=void 0,n3=void 0,s=(xin+yin+zin)*F3,i=Math.floor(xin+s),j=Math.floor(yin+s),k=Math.floor(zin+s),t=(i+j+k)*G3,x0=xin-i+t,y0=yin-j+t,z0=zin-k+t,i1=void 0,j1=void 0,k1=void 0,i2=void 0,j2=void 0,k2=void 0,x0>=y0?y0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=1,k2=0):x0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=0,k2=1):(i1=0,j1=0,k1=1,i2=1,j2=0,k2=1):z0>y0?(i1=0,j1=0,k1=1,i2=0,j2=1,k2=1):z0>x0?(i1=0,j1=1,k1=0,i2=0,j2=1,k2=1):(i1=0,j1=1,k1=0,i2=1,j2=1,k2=0),x1=x0-i1+G3,y1=y0-j1+G3,z1=z0-k1+G3,x2=x0-i2+2*G3,y2=y0-j2+2*G3,z2=z0-k2+2*G3,x3=x0-1+3*G3,y3=y0-1+3*G3,z3=z0-1+3*G3,i&=255,j&=255,k&=255,gi0=gradP[i+perm[j+perm[k]]],gi1=gradP[i+i1+perm[j+j1+perm[k+k1]]],gi2=gradP[i+i2+perm[j+j2+perm[k+k2]]],gi3=gradP[i+1+perm[j+1+perm[k+1]]],t0=.6-x0*x0-y0*y0-z0*z0,0>t0?n0=0:(t0*=t0,n0=t0*t0*gi0.dot3(x0,y0,z0)),t1=.6-x1*x1-y1*y1-z1*z1,0>t1?n1=0:(t1*=t1,n1=t1*t1*gi1.dot3(x1,y1,z1)),t2=.6-x2*x2-y2*y2-z2*z2,0>t2?n2=0:(t2*=t2,n2=t2*t2*gi2.dot3(x2,y2,z2)),t3=.6-x3*x3-y3*y3-z3*z3,0>t3?n3=0:(t3*=t3,n3=t3*t3*gi3.dot3(x3,y3,z3)),32*(n0+n1+n2+n3)},module.perlin2=function(x,y){var X,Y,n00,n01,n10,n11,u;return X=Math.floor(x),Y=Math.floor(y),x-=X,y-=Y,X=255&X,Y=255&Y,n00=gradP[X+perm[Y]].dot2(x,y),n01=gradP[X+perm[Y+1]].dot2(x,y-1),n10=gradP[X+1+perm[Y]].dot2(x-1,y),n11=gradP[X+1+perm[Y+1]].dot2(x-1,y-1),u=fade(x),lerp(lerp(n00,n10,u),lerp(n01,n11,u),fade(y))},module.perlin3=function(x,y,z){var X,Y,Z,n000,n001,n010,n011,n100,n101,n110,n111,u,v,w;return X=Math.floor(x),Y=Math.floor(y),Z=Math.floor(z),x-=X,y-=Y,z-=Z,X=255&X,Y=255&Y,Z=255&Z,n000=gradP[X+perm[Y+perm[Z]]].dot3(x,y,z),n001=gradP[X+perm[Y+perm[Z+1]]].dot3(x,y,z-1),n010=gradP[X+perm[Y+1+perm[Z]]].dot3(x,y-1,z),n011=gradP[X+perm[Y+1+perm[Z+1]]].dot3(x,y-1,z-1),n100=gradP[X+1+perm[Y+perm[Z]]].dot3(x-1,y,z),n101=gradP[X+1+perm[Y+perm[Z+1]]].dot3(x-1,y,z-1),n110=gradP[X+1+perm[Y+1+perm[Z]]].dot3(x-1,y-1,z),n111=gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1,y-1,z-1),u=fade(x),v=fade(y),w=fade(z),lerp(lerp(lerp(n000,n100,u),lerp(n001,n101,u),w),lerp(lerp(n010,n110,u),lerp(n011,n111,u),w),v)}}(this),window.CJ||(window.CJ={}),CJ.Unit=function(){function Unit(){this.entity||(this.entity=new pc.fw.Entity),this.events||(this.events={})}return Unit.app=void 0,Unit.prototype.addContext=function(context){return context?context.addChild(this.entity):CJ.instance.application.context.root.addChild(this.entity)},Unit.prototype.translate=function(x,y,z){return this.entity.translate(x,y,z)},Unit.prototype.rotateLocal=function(x,y,z){return this.entity.rotateLocal(x,y,z)},Unit.prototype.translateLocal=function(x,y,z){return this.entity.translateLocal(x,y,z)},Unit.prototype.setLocalPosition=function(x,y,z){return this.entity.setLocalPosition(x,y,z)},Unit.prototype.setPosition=function(x,y,z){return this.entity.setPosition(x,y,z)},Unit.prototype.getPosition=function(){return this.entity.getPosition()},Unit.prototype.getLocalRotation=function(){return this.entity.getLocalRotation()},Unit.prototype.getLocalPosition=function(){return this.entity.getLocalPosition()},Unit.prototype.lookAt=function(x,y,z){var pos;return x instanceof CJ.Unit?(pos=x.getPosition(),void this.entity.lookAt(pos.x,pos.y,pos.z)):this.entity.lookAt(x,y,z)},Unit.prototype.addScript=function(name,attrs){return CJ.Script.add(name,this,attrs)},Unit.prototype.on=function(name,callback){return"function"!=typeof callback?void CJ.log("This event("+name+") is not a function."):this.events[name]=callback},Unit.prototype.call=function(name,attrs){return this.events[name]?"function"!=typeof this.events[name]?void CJ.log("This event("+name+") is not a function."):this.events[name](attrs):void CJ.log("This event("+name+") doesnt exist.")},Unit}(),window.CJ||(window.CJ={}),CJ.Assets=function(){function Assets(){}return Assets.assets={},Assets.load=function(callback){var requests;return requests=[CJ.instance.application.context.assets.loadFromUrl("./assets/music/afrola.mp3","audio")],pc.promise.all(requests).then(function(_this){return function(results){var result,_i,_len;for(_i=0,_len=results.length;_len>_i;_i++)result=results[_i],_this.assets[result.asset.name]=result.asset;return callback(results)}}(this))},Assets}(),console.log("------------------------------------\n--      ClipJump   v.'1.0.0'      --\n------------------------------------\n-- Copyright © 2014~2015 Clipjump --\n--   Copyright © 2014~2015 Muit   --\n--     (miguel_3c@hotmail.com)    --\n------------------------------------\n"),window.CJ||(window.CJ={}),CJ.log=function(message){return console.log("ClipJump: "+message)},CJ.start=function(){var game;return game=new CJ.Game,game.start(),game},CJ.editor=function(designer){var game;return game=new CJ.Game,game.editor(designer),game},CJ.Game=function(){function Game(){}var application;return application={},Game.prototype.start=function(){return this.play=!0,CJ.instance=this,this.canvas=document.getElementById("canvas"),this.application=new pc.fw.Application(this.canvas),this.application.setCanvasFillMode(pc.fw.FillMode.FILL_WINDOW),this.application.setCanvasResolution(pc.fw.ResolutionMode.AUTO),this.application.start(),CJ.Assets.load(function(_this){return function(){return _this.onload()}}(this))},Game.prototype.editor=function(application){if(this.application=application,this.play=!1,!this.application)throw new Error("Need an application object!");return CJ.instance=this,CJ.Assets.load(function(_this){return function(){return _this.onload()}}(this))},Game.prototype.onload=function(){var self;return CJ.log("Starting ClipJump"),this.application.context.scene.ambientLight=new pc.Color(.2,.2,.2),this.map=new CJ.Map(CJ.Level.ProceduralLevel),this.light=new CJ.Light({type:"directional",castShadows:!0,color:new pc.Color(1,1,1),castShadows:!0,shadowResolution:2048}),this.light.rotateLocal(45,30,0),this.light.translate(2,2,2),this.player=new CJ.Player,this.player.translate(1,1,1),this.play&&this.player.addScript("input_handler"),this.map.level.addPlayer(this.player),this.camera=new CJ.Camera(this.player.entity),this.camera.addScript("camera_movement",{player:this.player}),self=this,this.application.on("update",function(){return function(dt){return self.update(dt)}}(this))},Game.prototype.onunload=function(){},Game.prototype.update=function(dt){return CJ.Script.update(dt),this.map.update(dt)},Game.prototype.error=function(message){throw new Error(message)},Game}(),CJ.Level=function(){function Level(map){this.map=map}return Level.prototype.load=function(){},Level.prototype.reset=function(){var entity,_i,_len,_ref,_results;for(_ref=this.map.entity._children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)entity=_ref[_i],_results.push(entity.destroy());return _results},Level.prototype.update=function(){},Level}(),CJ.Map=function(_super){function Map(level,attrs){Map.__super__.constructor.apply(this,arguments),this.addContext(),level&&this.load(level,attrs)}return __extends(Map,_super),Map.prototype.load=function(level,attrs){return this.level=new level(this,attrs),this.level.load()},Map.prototype.reset=function(){return this.level.reset()},Map.prototype.update=function(dt){return this.level.update(dt)},Map}(CJ.Unit),CJ.Script=function(){function Script(){}return Script._list={},Script.scripts_loaded=[],Script.create=function(name,callback){return this._list[name]=callback()},Script.add=function(name,unit,attrs){var script;return script=new this._list[name](unit),script.initialize(attrs),unit.scripts||(unit.scripts={}),unit.scripts[name]=script,this.scripts_loaded.push(script),script},Script.remove=function(name,unit){var script;if(!unit.scripts)throw new Error("Current unit doesn't have any script.");if(script=unit.scripts[name],!script)throw new Error("Current unit doesn't have the "+name+" script.");return unit.scripts[name]=void 0,this.scripts_loaded.remove(script)},Script.update=function(dt){var script,_i,_len,_ref,_results;for(_ref=this.scripts_loaded,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)script=_ref[_i],_results.push(script.update(dt));return _results},Script}(),CJ.Cube=function(_super){function Cube(){Cube.__super__.constructor.apply(this,arguments)}return __extends(Cube,_super),Cube}(CJ.Unit),CJ.Cube=function(_super){function Cube(){Cube.__super__.constructor.apply(this,arguments)}return __extends(Cube,_super),Cube}(CJ.Unit),CJ.Cube=function(_super){function Cube(id,context){var type;this.id=null!=id?id:1,Cube.__super__.constructor.apply(this,arguments),type=CJ.Cube.Types.getById(id),CJ.instance.application.context.systems.model.addComponent(this.entity,{type:"box",castShadows:!0,receiveShadows:!0}),CJ.instance.application.context.systems.collision.addComponent(this.entity,{type:"box",halfExtents:new pc.Vec3(.5,.5,.5)}),this.addContext(context)}return __extends(Cube,_super),Cube.prototype.setColor=function(color){var material;return material=new pc.scene.PhongMaterial,material.diffuse=color,material.update(),this.entity.model.material=material},Cube.prototype.destroy=function(){return this.entity.destroy()},Cube["new"]=function(id,attrs){var r_class;return new(r_class=CJ.Cube.Types.getClass(CJ.Cube.Types.getById(id)))(attrs)},Cube}(CJ.Unit),CJ.Cube.Types=function(){function Types(){}return Types._all=[],Types.add=function(id,name,r_class,stats){return this._all[id]={id:id,name:name,stats:stats,r_class:r_class}},Types.getById=function(id){return this._all[id]},Types.getByName=function(name){var results,type,_i,_len,_ref;for(results=[],_ref=this._all,_i=0,_len=_ref.length;_len>_i;_i++)type=_ref[_i],name===type.name&&results.push(type);return results.length>0?results:void 0},Types.getByClass=function(r_class){var results,type,_i,_len,_ref;for(results=[],_ref=this._all,_i=0,_len=_ref.length;_len>_i;_i++)type=_ref[_i],r_class===type.r_class&&results.push(type);return results.length>0?results:void 0},Types.getClass=function(type){return CJ.Cube[type.r_class]},Types.add(0,"Nothing",void 0,void 0),Types.add(1,"Blue Box","Blue",void 0),Types.add(2,"Green Box","Green",void 0),Types.add(3,"Red Box","Red",void 0),Types.add(4,"Player Box","Player",void 0),Types.add(5,"Point Box","Point",void 0),Types.add(6,"End Box","End",void 0),Types}(),CJ.Light=function(_super){function Light(opts){if(Light.__super__.constructor.apply(this,arguments),!opts)throw new Error("Light options must be provided.");opts.color=opts.color||new pc.Color(1,0,0),opts.type=opts.type||"point",opts.radius=opts.radius||10,CJ.instance.application.context.systems.light.addComponent(this.entity,opts),this.addContext()}return __extends(Light,_super),Light.prototype.setColor=function(){},Light}(CJ.Unit),CJ.Camera=function(_super){function Camera(context,color){Camera.__super__.constructor.apply(this,arguments),CJ.instance.application.context.systems.camera.addComponent(this.entity,{clearColor:color?color:new pc.Color(.6,.6,.6)}),this.addContext(context)}return __extends(Camera,_super),Camera}(CJ.Unit),CJ.Cube.Blue=function(_super){function Blue(context){Blue.__super__.constructor.call(this,1,context),this.setColor(new pc.Color(0,0,1))}return __extends(Blue,_super),Blue}(CJ.Cube),CJ.Cube.Green=function(_super){function Green(context){Green.__super__.constructor.call(this,2,context),this.setColor(new pc.Color(0,1,0))}return __extends(Green,_super),Green}(CJ.Cube),CJ.Player=function(_super){function Player(context){Player.__super__.constructor.call(this,4,context),CJ.instance.application.context.systems.rigidbody.addComponent(this.entity,{type:"dynamic",mass:50,restitution:.5}),this.setColor(new pc.Color(.5411,.9215,.949))}return __extends(Player,_super),Player}(CJ.Cube),CJ.Cube.Red=function(_super){function Red(context){Red.__super__.constructor.call(this,3,context),this.setColor(new pc.Color(1,0,0))}return __extends(Red,_super),Red}(CJ.Cube),CJ.Model||(CJ.Model={}),CJ.Model.Bullet=function(_super){function Bullet(context){Bullet.__super__.constructor.apply(this,arguments),CJ.instance.application.context.systems.model.addComponent(this.entity,{type:"box",castShadows:!0,receiveShadows:!0}),this.entity.setLocalScale(.3,.1,.1),this.addContext(context)}return __extends(Bullet,_super),Bullet}(CJ.Unit),CJ.Level.map_0=function(_super){function map_0(map){map_0.__super__.constructor.call(this,map),this.blocks={0:{0:{0:1},1:{0:1},2:{0:1},3:{0:1},4:{0:1},5:{0:1},6:{0:1},7:{0:1}},1:{0:{0:1},1:{0:1},2:{0:1},3:{0:1},4:{0:1},5:{0:1},6:{0:1},7:{0:1}},2:{0:{0:1},1:{0:1},2:{0:1},3:{0:1},4:{0:1},5:{0:1},6:{0:1},7:{0:1}},3:{0:{0:1},1:{0:1},2:{0:1,1:3},3:{0:1},4:{0:1},5:{0:1},6:{0:1},7:{0:1}},4:{0:{0:1},1:{0:1},2:{0:1},3:{0:1,1:2},4:{0:1},5:{0:1},6:{0:1},7:{0:1}},5:{0:{0:1},1:{0:1},2:{0:1},3:{0:1},4:{0:1},5:{0:1},6:{0:1},7:{0:1}},6:{0:{0:1},1:{0:1},2:{0:1},3:{0:1},4:{0:1},5:{0:1},6:{0:1},7:{0:1}},7:{0:{0:1},1:{0:1},2:{0:1},3:{0:1},4:{0:1},5:{0:1},6:{0:1},7:{0:1}}}}return __extends(map_0,_super),map_0.prototype.load=function(){var cube,cubeId,line,plane,x,y,z,_ref,_results;_ref=this.blocks,_results=[];for(z in _ref)plane=_ref[z],_results.push(function(){var _results1;_results1=[];for(x in plane)line=plane[x],_results1.push(function(){var _results2;_results2=[];for(y in line)cubeId=line[y],0!==cubeId?(cube=CJ.Cube["new"](cubeId,this.map.entity),_results2.push(cube.translate(x,y,z))):_results2.push(void 0);return _results2}.call(this));return _results1}.call(this));return _results},map_0}(CJ.Level),CJ.Level.ProceduralLevel=function(_super){function ProceduralLevel(map,attrs){ProceduralLevel.__super__.constructor.call(this,map),attrs||(attrs={}),this.seed=attrs.seed||String.random(),this.ranges=[],this.surface=[],this.noise=new Noise(1,1,.1,-2,2,this.seed)}return __extends(ProceduralLevel,_super),ProceduralLevel.prototype.initialize=function(){return Math.seedrandom(this.seed)},ProceduralLevel.prototype.update=function(dt){var range,self,_i,_len,_ref,_results;for(self=this,_ref=this.ranges,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)range=_ref[_i],_results.push(range.update(dt,function(){return function(blocks){return self.renderNewBlocks(blocks)}}(this)));return _results},ProceduralLevel.prototype.addPlayer=function(player){return this.addRange("SquareRange",{player:player})},ProceduralLevel.prototype.addRange=function(type,attrs){var range_class;if(range_class=CJ.Level.ProceduralLevel[type],!range_class)throw new Error("The range "+type+" does not exist.");return this.ranges.push(new range_class(attrs))},ProceduralLevel.prototype.renderNewBlocks=function(blocks){var block,cube,_i,_len,_results;for(_results=[],_i=0,_len=blocks.length;_len>_i;_i++)block=blocks[_i],void 0===this.surface[block.x]&&(this.surface[block.x]=[]),void 0===this.surface[block.x][block.y]?(this.surface[block.x][block.y]=cube=new CJ.Cube.Blue,cube.translate(block.x,this.noise.get(block.x,block.y),block.y),_results.push(cube.addScript("spawn_animation"))):_results.push(void 0);return _results},ProceduralLevel}(CJ.Level),CJ.Level.ProceduralLevel.CircularRange=function(){function CircularRange(attrs){this.player=attrs.player,this.range=attrs.range||8}return CircularRange.prototype.update=function(dt,callback){var center,p_position;return p_position=this.player.getPosition(),center=new Vector2(Math.round(p_position.x),Math.round(p_position.z)),center.distance(0!==this.center)?(this.center=center,callback(obtainBlocks())):void 0},CircularRange.prototype.obtainBlocks=function(){var blocks;return blocks=[this.center]},CircularRange}(),CJ.Level.ProceduralLevel.SquareRange=function(){function SquareRange(attrs){var p_position;this.player=attrs.player,this.range=attrs.range||8,p_position=this.player.getPosition(),this.center=new Vector2(Math.round(p_position.x),Math.round(p_position.z))}return SquareRange.prototype.update=function(dt,callback){var center,p_position;return p_position=this.player.getPosition(),center=new Vector2(Math.round(p_position.x),Math.round(p_position.z)),0!==center.distance(this.center)?(this.center=center,callback(this.obtainBlocks())):void 0},SquareRange.prototype.obtainBlocks=function(){var blocks,x,y,_i,_j,_ref,_ref1,_ref2,_ref3;for(blocks=[],x=_i=_ref=this.center.x-this.range,_ref1=this.center.x+this.range;_ref1>=_ref?_ref1>=_i:_i>=_ref1;x=_ref1>=_ref?++_i:--_i)for(y=_j=_ref2=this.center.y-this.range,_ref3=this.center.y+this.range;_ref3>=_ref2?_ref3>=_j:_j>=_ref3;y=_ref3>=_ref2?++_j:--_j)blocks.push(new Vector2(x,y));return blocks},SquareRange}(),CJ.Script.create("camera_movement",function(){return function(){var CameraMovement;return CameraMovement=function(){function CameraMovement(camera){this.camera=camera,this.rads=0,this.y_rads=0,this.dir=!1}return CameraMovement.prototype.initialize=function(attrs){return this.height=attrs.height||5,this.distance=attrs.distance||13,this.speed=attrs.speed||3,this.player=attrs.player,this.keyboard=new pc.input.Keyboard(document),this.keyboard.on("keydown",this.onKeyDown,this),this.camera.setLocalPosition(0,this.height,this.distance),this.camera.lookAt(this.player)},CameraMovement.prototype.onKeyDown=function(e){if(e.key===pc.input.KEY_P)this.rads-=Math.PI/2,this.dir=!1;else{if(e.key!==pc.input.KEY_O)return;this.rads+=Math.PI/2,this.dir=!0}return this.obj_x=this.distance*Math.round(Math.sin(this.rads)),this.obj_z=this.distance*Math.round(Math.cos(this.rads)),this.player.call("flip_controls",this.dir)},CameraMovement.prototype.update=function(dt){var position,x,z;return position=this.camera.getLocalPosition(),x=position.x,z=position.z,this.obj_x-.5>=x||this.obj_x+.5<=x||this.obj_z-.5>=z||this.obj_z+.5<=z?(this.y_rads=this.dir?this.y_rads+this.speed*dt:this.y_rads-this.speed*dt,x=this.distance*Math.sin(this.y_rads),z=this.distance*Math.cos(this.y_rads),this.camera.setLocalPosition(x,this.height,z),this.camera.lookAt(this.player)):void 0},CameraMovement}()}}(this)),CJ.Script.create("input_handler",function(){return function(){var InputHandler;return InputHandler=function(){function InputHandler(unit){this.unit=unit,this.speed=3,this.movements=["forward","left","back","right"],this.unit.entity.rigidbody||CJ.instance.application.context.systems.rigidbody.addComponent(this.entity,{type:"dynamic",mass:50,restitution:.5})}return InputHandler.prototype.initialize=function(){var self;return this.controller=new pc.input.Controller(document),this.controller.registerKeys("forward",[pc.input.KEY_UP,pc.input.KEY_W]),this.controller.registerKeys("back",[pc.input.KEY_DOWN,pc.input.KEY_S]),this.controller.registerKeys("left",[pc.input.KEY_LEFT,pc.input.KEY_A]),this.controller.registerKeys("right",[pc.input.KEY_RIGHT,pc.input.KEY_D]),this.keyboard=new pc.input.Keyboard(document),this.keyboard.on("keydown",this.onKeyDown,this),self=this,this.unit.on("flip_controls",function(){return function(direction){return direction===!0?self.movements.getLastFlip():direction===!1?self.movements.getNextFlip():void 0}}(this))},InputHandler.prototype.onKeyDown=function(e){return e.key===pc.input.KEY_SPACE?this.unit.entity.rigidbody.applyImpulse(0,-1,0):void 0},InputHandler.prototype.update=function(dt){var x,z;return z=0,this.controller.isPressed(this.movements[0])?z=-1:this.controller.isPressed(this.movements[2])&&(z=1),x=0,this.controller.isPressed(this.movements[1])?x=-1:this.controller.isPressed(this.movements[3])&&(x=1),this.unit.translate(x*this.speed*dt,0,z*this.speed*dt),this.unit.entity.rigidbody.syncEntityToBody()},InputHandler}()}}(this)),CJ.Script.create("spawn_animation",function(){return function(){var SpawnAnimation;return SpawnAnimation=function(){function SpawnAnimation(unit){this.unit=unit,this.speed=4.5,this.height=4,this.delta=Math.abs(this.height)}return SpawnAnimation.prototype.initialize=function(){return this.y_0=this.unit.getPosition().y,this.unit.translate(0,this.height,0)},SpawnAnimation.prototype.update=function(dt){var amount;return this.delta>0?(amount=this.speed*dt,this.delta-=amount,this.unit.translate(0,this.height>0?-amount:amount,0)):this.unit.getPosition().y!==this.y_0?this.unit.translate(0,-this.unit.getPosition().y-this.y_0,0):void 0},SpawnAnimation}()}}(this))}).call(this);